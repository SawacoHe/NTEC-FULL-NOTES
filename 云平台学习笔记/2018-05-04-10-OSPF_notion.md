---
layout: post
share: true
title: OSPF路由协议基础 - 基本概念
description: 邻居和邻接/OSPF定义的网络类型/DR和BDR/OSPF区域
date: 2018-05-04
---

### 邻居和邻接

```
             邻居/HELLO
    10.1.1.1           10.1.1.2
      |                    |
      |                    |
<-------------------------------->
<-------------------------------->
      |                    |
      |                    |
    10.1.1.3<--------->10.1.1.4
             邻接/同步成功
```

通过以下命令查看邻居/邻接状态

```
[R1]dis ospf peer b

>two way:邻居关系（发送HELLO确认成功）
>full:邻接关系（两台设备数据库同步成功）
```

### OSPF定义的网络类型

🔨 点到点网络

```
    10.1.1.1           10.1.1.2
       R1<--------------->R2
               PPP
```

🔨 广播型网络

```
    10.1.1.1           10.1.1.2
      |                    |
      |                    |
<-------------------------------->
<-------------------------------->
      |                    |
      |                    |
    10.1.1.3           10.1.1.4
              Ethernet
```

要保证两两邻接，需要建立n*(n-1)/2个邻接关系，出现故障排查不便

🔨 NBMA网络

non-broadcast/multi-access 非广播多点接入网络

```
VPI/VCI=0/102      R1         VPI/VCI=0/103
    |              |10.1.1.1         |
    |              |                 |
    |             ATM                |
    |              |                 |
    |              |                 |
    |          ----------            |
    |          |        |            |
    |          |        |            |
    |          R1       R2           |
    |    10.1.1.2       10.1.1.3     |
    |                                |
VPI/VCI=0/201-----------------VPI/VCI=0/301
```

🔨 PTMP网络

point to multi-point 点到多点网络

（由NBMA网络演变出来的网络）

```
VPI/VCI=0/102      R1         VPI/VCI=0/103
    |              |10.1.1.1         |
    |              |                 |
    |              FR                |
    |              |                 |
    |              |                 |
    |          ----------            |
    |          |        |            |
    |          |        |            |
    |          R1       R2           |
    |    10.1.1.2       10.1.1.3     |
    |                                |
VPI/VCI=0/201                 VPI/VCI=0/301
```

### DR和BDR

DR: 指定路由器。（用来减少网络连接关系同时保证数据库能够同步完成）

🔨 DR选举条件？

 - 在广播型网络和NDMA网络中选举DR
 - 在同网段中选举DR
 - 网络接口优先级大于0

🔨 DR如何选举？  

DR在建立邻居的时候即开始选举，发送HELLO报文，比较本路由器和其他路由器的优先级，优先级低的自动放弃选举DR，优先级相同时，比较router-id，router-id大的作为DR，次一级则作为BDR，其他的为普通路由器。即：
1. 比较优先级
2. 比较router-id

🔨 DR/BDR/普通路由器的邻居邻接关系？

 - DR与BDR和普通路由器都为邻接关系
 - BDR与DR和普通路由器都为邻接关系
 - 普通路由器和普通路由器为邻居关系（不需要数据库同步）

🔨 这样做的意义？

可以大幅度减少路由器之间的邻接建立数量。

比如，对于一个拥有40个路由器的广播型网络，如果不选举DR和BDR，根据`n*(n-1)/2`的计算公式，此时要建立`40*39/2=780`个邻接关系，而通过选举DR和BDR，邻接关系的数量减少到`39+38=77`个。由此可见，DR和BDR的引入大幅度减少了多设备网络直接的邻接关系。

🔨 DR选举完之后，权力遵循永久制和世袭制。

新路由器的引入不会导致重新选举DR；

DR淘汰之后，由BDR继承DR。

### OSPF区域

Area 0为骨干区域，所有ABR都至少有一个接口属于Area 0.

🔨 划分区域的理由？

1. LSA存储和LSDB计算的资源考虑；
2. 减少网络动荡所带来的影响（将动荡限制在area内）；

🔨 划分骨干区域Area 0的目的？

统一路由信息发布，避免产生路由风暴。

非骨干区域不得两两转发路由信息。

OSPF协议无环路。

🔨 区域划分的单位？

路由器端口。

🔨 路由器角色？

 - IR: 所有端口都在非骨干区域的路由器
 - ABR: 至少有一个端口在骨干区域的路由器
 - BR: 所有参与组网的端口都在骨干区域的路由器
 - ASBR: 位于自治系统边界（引入了其他协议）的路由器